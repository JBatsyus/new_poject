// /**** MAP ****/
//

// Группы объектов
var groups = [
  {
    name: "",
    style: "islands#redIcon",
    items: [
      
      {
        center: [55.687852, 37.534950],
        name: "ТРЦ Лето",
        address: "Ул. Ромашек, д. 11, стр. 2, офис 30",
        tel: "8 (812) 456-62-92",
        time1:" 09:00-20:00",
        time2:"СБ: 09:00-19:00",
        time3:"ВС: 09:00-18:00",
        link: "storelink.ru"
        
      },
      {
        center: [55.762049, 37.595728],
        name: "ТРЦ Лето",
        address: "м. Академическая, ул. Профсоюзная, д. 16/10, 1 этаж",
        tel: "8 (812) 456-62-92",
        time1:" 09:00-20:00",
        time2:"СБ: 09:00-19:00",
        time3:"ВС: 09:00-18:00",
        link: "storelink.ru"
        
      },
      {
        center: [55.762049, 37.595728],
        name: "ТРЦ Лето",
        address: "м. Октябрьское поле, Народного ополчения, \n" +
          "д. 44, к. 1, 1 этаж.",
        tel: "8 (812) 456-62-92",
        time1:" 09:00-20:00",
        time2:"СБ: 09:00-19:00",
        time3:"ВС: 09:00-18:00",
        link: "storelink.ru"
        
      },
      {
        center: [55.756650, 37.651497],
        
        address: "м. Академическая, ул. Профсоюзная, д. 16/10, \n" +
          "1 этаж",
        name: "ТЦ Золотой Вавилон Отрадное",
        tel: "8 (812) 456-62-92",
        time1:" 09:00-20:00",
        time2:"СБ: 09:00-19:00",
        time3:"ВС: 09:00-18:00",
        link: "storelink.ru"
        
      },
      {
        center: [55.754744, 37.643235],
        name: "ТЦ Калужский",
        address: "м. Октябрьское поле, Народного ополчения, \n" +
          "д. 44, к. 1, 1 этаж.",
        tel: "8 (812) 456-62-92",
        time1:" 09:00-20:00",
        time2:"СБ: 09:00-19:00",
        time3:"ВС: 09:00-18:00",
        link: "storelink.ru"
        
      },
      {
        center: [55.756967, 37.604366],
        name: "ТЦ Спектр",
        address: "м. Октябрьское поле, Народного ополчения, \n" +
          "д. 44, к. 1, 1 этаж.",
        tel: "8 (812) 456-62-92",
        time1:" 09:00-20:00",
        time2:"СБ: 09:00-19:00",
        time3:"ВС: 09:00-18:00",
        link: "storelink.ru"
        
      },
      {
        center: [55.763002, 37.594038],
        name: "ТЦ Спектр",
        address: "м. Октябрьское поле, Народного ополчения, \n" +
          "д. 44, к. 1, 1 этаж.",
        tel: "8 (812) 456-62-92",
        time1:" 09:00-20:00",
        time2:"СБ: 09:00-19:00",
        time3:"ВС: 09:00-18:00",
        link: "storelink.ru"
        
      },
      {
        center: [55.747648, 37.596104],
        name: "ТЦ Спектр",
        address: "м. Октябрьское поле, Народного ополчения, \n" +
          "д. 44, к. 1, 1 этаж.",
        tel: "8 (812) 456-62-92",
        time1:" 09:00-20:00",
        time2:"СБ: 09:00-19:00",
        time3:"ВС: 09:00-18:00",
        link: "storelink.ru"
        
      },
      {
        center: [55.745000, 37.591597],
        name: "ТЦ Спектр",
        address: "м. Октябрьское поле, Народного ополчения, \n" +
          "д. 44, к. 1, 1 этаж.",
        tel: "8 (812) 456-62-92",
        time1:" 09:00-20:00",
        time2:"СБ: 09:00-19:00",
        time3:"ВС: 09:00-18:00",
        link: "storelink.ru"
        
      },
      {
        center: [55.746801, 37.603427],
        name: "ТЦ Спектр",
        address: "м. Октябрьское поле, Народного ополчения, \n" +
          "д. 44, к. 1, 1 этаж.",
        tel: "8 (812) 456-62-92",
        time1:" 09:00-20:00",
        time2:"СБ: 09:00-19:00",
        time3:"ВС: 09:00-18:00",
        link: "storelink.ru"
        
      },
      {
        center: [55.754426, 37.623894],
        name: "ТЦ Спектр",
        address: "м. Октябрьское поле, Народного ополчения, \n" +
          "д. 44, к. 1, 1 этаж.",
        tel: "8 (812) 456-62-92",
        time1:" 09:00-20:00",
        time2:"СБ: 09:00-19:00",
        time3:"ВС: 09:00-18:00",
        link: "storelink.ru"
      },
      {
        center: [50.50955, 30.60791],
        name: "ТЦ Спектр",
        address: "м. Октябрьское поле, Народного ополчения, \n" +
          "д. 44, к. 1, 1 этаж.",
        tel: "8 (812) 456-62-92",
        time1:" 09:00-20:00",
        time2:"СБ: 09:00-19:00",
        time3:"ВС: 09:00-18:00",
        link: "storelink.ru"
        
      },
      {
        center: [50.50955, 30.60791],
        name: "ТЦ Спектр",
        address: "м. Октябрьское поле, Народного ополчения, \n" +
          "д. 44, к. 1, 1 этаж.",
        tel: "8 (812) 456-62-92",
        time1:" 09:00-20:00",
        time2:"СБ: 09:00-19:00",
        time3:"ВС: 09:00-18:00",
        link: "storelink.ru"
        
      },
    ]}
];

if($("#map-partners").length > 0) {
  
  ymaps.ready(init);
  
  function init() {
    
    // Создание экземпляра карты.
    var myMap = new ymaps.Map('map-partners', {
      center: [55.756650, 37.651497],
      zoom: 15,
      controls: ['geolocationControl']
    }, {
      searchControlProvider: 'yandex#search'
      
    })
    // myMap.behaviors.disable('scrollZoom');
    // myMap.behaviors.disable('multiTouch');
    // myMap.behaviors.disable('drag');
    
    // Контейнер для меню.
    var menu = $('<div class="menu"></div>');
    
    for (var i = 0, l = groups.length; i < l; i++) {
      createMenuGroup(groups[i]);
    }
    
    function createMenuGroup(group) {
      // Пункт меню.
      // var menuItem = $('<li><a href="javascript:void(0);">' + group.name + '</a></li>'),
      // Коллекция для геообъектов группы.
      var collection = new ymaps.GeoObjectCollection(null, {preset: group.style}),
        // Контейнер для подменю.
        
        submenu = $('<ul class="shop-list"></ul>');
      // Добавляем коллекцию на карту.
      myMap.geoObjects.add(collection);
      // Добавляем подменю.
      menu
        .append(submenu)
        // Добавляем пункт в меню.
        .appendTo(menu)
        // По клику удаляем/добавляем коллекцию на карту и скрываем/отображаем подменю.
        .find('a')
        .bind('click', function () {
          if (collection.getParent()) {
            myMap.geoObjects.remove(collection);
            submenu.show();
          } else {
            myMap.geoObjects.add(collection);
            submenu.show();
          }
        });
      for (var j = 0, m = group.items.length; j < m; j++) {
        createSubMenu(group.items[j], collection, submenu);
      }
    }
    
    function createSubMenu(item, collection, submenu) {
      // Пункт подменю.
      var submenuItem = $('<li class="partners__list-item">' +
          '<a href="#" class="partners__list-link">' +
          '<div class="partners__list-item__left">' +
          
          '<div class="partners__list-title">' + item.name + '</div>' +
          '<div class="partners__list-address">' + item.address + '</div>' +
          '</div>' +
          
          '<div class="partners__list-item__right">' +
          '<div class="partners__list-phone">' + item.tel + '</div>' +
          '<div class="partners__list-time">' + item.time1 +'</div>' +
          '</div>' +
          '</a>' +
          '</li>'),
        
        // // Создаем метку.
        placemark = new ymaps.Placemark(item.center, {
            balloonContent: "\t\t\t\t\t<div class=\"balloon\">\n" +
              
              "\t\t\t\t\t\t<div class=\"balloon-title\">" + item.name + "</div>\n" +
              "\t\t\t\t\t\t<div class=\"balloon-contacts\">\n" +
              "\t\t\t\t\t\t\t<div class=\"balloon-contacts__block\">\n" +
              "\t\t\t\t\t\t\t\t<div class=\"balloon-contacts__block_icon balloon-contacts__block_icon_geo\"></div>\n" +
              "\t\t\t\t\t\t\t\t<div class=\"balloon-contacts__block_desc\">" + item.address + "</div>\n" +
              "\t\t\t\t\t\t\t<a class=\"balloon-contacts__block_tel\" href=\"tel: " + item.tel + "\">" + item.tel + "</a>\n" +
              "\t\t\t\t\t\t\t\t<div class=\"balloon-time\">" +
              "<div class=\"balloon-time__title\">Время работы:</div>" +
              "<div class=\"balloon-time__count\">" + item.time1 + "</div>" +
              "</div>\n" +
              
              "\t\t\t\t\t\t\t</div>\n" +
              "\t\t\t\t\t\t</div>\n" +
              
              "\t\t\t\t\t</div>\n"
          },
          {
            // Опции.
            // Необходимо указать данный тип макета.
            iconLayout: 'default#image',
            // Своё изображение иконки метки.
            iconImageHref: './img/icon-geo.svg',
            // Размеры метки.
            iconImageSize: [50, 50],
            // Смещение левого верхнего угла иконки относительно
            // её "ножки" (точки привязки).
            iconImageOffset: [0, -0],
            hideIconOnBalloonOpen: false,
            balloonOffset: [-250, -1],
            closeButton: false,
            balloonAutoPanMargin:2,
            balloonPanelMaxMapArea: 0,
            // openBalloonOnClick: false
          });
      
      
      
      
      // Добавляем метку в коллекцию.
      collection.add(placemark);
      
      placemark.events.add('click', function (e) {
        e.get('target').options.set({
          iconImageHref: './img/icon-geo.svg',
          iconImageSize: [50, 50]
        });
      });
      // Добавляем пункт в подменю.
      submenuItem
        .appendTo(submenu)
        // При клике по пункту подменю открываем/закрываем баллун у метки.
        .find('a')
        .bind('click', function (e) {
          var fixed_offset = 50;
          var mapOffset = $('#map-partners').offset().top - 150;
          
          $('html,body').stop().animate({ scrollTop: mapOffset}, 1000);
          e.preventDefault();
          if (!placemark.balloon.isOpen()) {
            placemark.balloon.open();
            
          } else {
            placemark.balloon.close();
          }
          return false;
          
          
          
        });
    }
    
    closeBalloon = function () {
      myMap.balloon.close();
    };
    
    
    // Добавляем меню в тэг BODY.
    menu.appendTo($('.shop-block'));
    
    
    // Выставляем масштаб карты чтобы были видны все группы.
    // myMap.setBounds(myMap.geoObjects.getBounds());
    
    
  }
}
